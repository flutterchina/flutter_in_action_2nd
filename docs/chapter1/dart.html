<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1.4 Dart语言简介 | 《Flutter实战·第二版》</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.c0f2585a.css" as="style"><link rel="preload" href="/assets/js/app.2b1dcc57.js" as="script"><link rel="preload" href="/assets/js/28.44b1edff.js" as="script"><link rel="preload" href="/assets/js/2.c4880edd.js" as="script"><link rel="preload" href="/assets/js/88.dd1d66b6.js" as="script"><link rel="prefetch" href="/assets/js/10.a2353258.js"><link rel="prefetch" href="/assets/js/100.86ae4583.js"><link rel="prefetch" href="/assets/js/101.44505abf.js"><link rel="prefetch" href="/assets/js/102.a333c690.js"><link rel="prefetch" href="/assets/js/103.44427188.js"><link rel="prefetch" href="/assets/js/104.87c9610d.js"><link rel="prefetch" href="/assets/js/105.2bf14a0c.js"><link rel="prefetch" href="/assets/js/106.156755f0.js"><link rel="prefetch" href="/assets/js/107.26550c74.js"><link rel="prefetch" href="/assets/js/108.420fcf3f.js"><link rel="prefetch" href="/assets/js/109.48aa7d5b.js"><link rel="prefetch" href="/assets/js/11.f1c636af.js"><link rel="prefetch" href="/assets/js/110.64dc2aa7.js"><link rel="prefetch" href="/assets/js/111.a0bfb520.js"><link rel="prefetch" href="/assets/js/112.1ac81b68.js"><link rel="prefetch" href="/assets/js/113.9b6e57a2.js"><link rel="prefetch" href="/assets/js/114.183e28a5.js"><link rel="prefetch" href="/assets/js/115.b6cc0020.js"><link rel="prefetch" href="/assets/js/116.c3e25b0e.js"><link rel="prefetch" href="/assets/js/117.ce78808e.js"><link rel="prefetch" href="/assets/js/118.8b5773c5.js"><link rel="prefetch" href="/assets/js/119.59c09f52.js"><link rel="prefetch" href="/assets/js/12.50d6f5aa.js"><link rel="prefetch" href="/assets/js/120.e01710b3.js"><link rel="prefetch" href="/assets/js/121.743965b4.js"><link rel="prefetch" href="/assets/js/122.f0cf4eb0.js"><link rel="prefetch" href="/assets/js/123.4d47fb39.js"><link rel="prefetch" href="/assets/js/124.a32a219a.js"><link rel="prefetch" href="/assets/js/125.47a2bafb.js"><link rel="prefetch" href="/assets/js/126.13d1e508.js"><link rel="prefetch" href="/assets/js/127.a49c1caf.js"><link rel="prefetch" href="/assets/js/128.fdee93c9.js"><link rel="prefetch" href="/assets/js/129.69587abf.js"><link rel="prefetch" href="/assets/js/13.c17ab9e7.js"><link rel="prefetch" href="/assets/js/130.02fa41b0.js"><link rel="prefetch" href="/assets/js/131.1213ad9f.js"><link rel="prefetch" href="/assets/js/14.3459b1c0.js"><link rel="prefetch" href="/assets/js/15.fa3005b3.js"><link rel="prefetch" href="/assets/js/16.2a07106b.js"><link rel="prefetch" href="/assets/js/17.44314353.js"><link rel="prefetch" href="/assets/js/18.5c08fdee.js"><link rel="prefetch" href="/assets/js/19.7290e713.js"><link rel="prefetch" href="/assets/js/20.4ac6ceca.js"><link rel="prefetch" href="/assets/js/21.0883b3d6.js"><link rel="prefetch" href="/assets/js/22.51f04f7c.js"><link rel="prefetch" href="/assets/js/23.9aa04c0d.js"><link rel="prefetch" href="/assets/js/24.d035449c.js"><link rel="prefetch" href="/assets/js/25.747679b2.js"><link rel="prefetch" href="/assets/js/26.fc83071c.js"><link rel="prefetch" href="/assets/js/27.49d3cb73.js"><link rel="prefetch" href="/assets/js/29.70a789e7.js"><link rel="prefetch" href="/assets/js/3.e66cbcde.js"><link rel="prefetch" href="/assets/js/30.f7579c80.js"><link rel="prefetch" href="/assets/js/31.e870a72a.js"><link rel="prefetch" href="/assets/js/32.593aaead.js"><link rel="prefetch" href="/assets/js/33.ffd79a63.js"><link rel="prefetch" href="/assets/js/34.719024a7.js"><link rel="prefetch" href="/assets/js/35.84318cd0.js"><link rel="prefetch" href="/assets/js/36.33391cb8.js"><link rel="prefetch" href="/assets/js/37.fc21b1cf.js"><link rel="prefetch" href="/assets/js/38.7dd97bf9.js"><link rel="prefetch" href="/assets/js/39.0b9e6aa5.js"><link rel="prefetch" href="/assets/js/4.d1912382.js"><link rel="prefetch" href="/assets/js/40.22e24124.js"><link rel="prefetch" href="/assets/js/41.ed7d27ae.js"><link rel="prefetch" href="/assets/js/42.d4bb0f55.js"><link rel="prefetch" href="/assets/js/43.3cebbf22.js"><link rel="prefetch" href="/assets/js/44.3ff46df2.js"><link rel="prefetch" href="/assets/js/45.2239d31d.js"><link rel="prefetch" href="/assets/js/46.d5ddf657.js"><link rel="prefetch" href="/assets/js/47.39163a61.js"><link rel="prefetch" href="/assets/js/48.42c84ed1.js"><link rel="prefetch" href="/assets/js/49.1fb8bc14.js"><link rel="prefetch" href="/assets/js/5.5beb2b2b.js"><link rel="prefetch" href="/assets/js/50.03a79e04.js"><link rel="prefetch" href="/assets/js/51.e5924aae.js"><link rel="prefetch" href="/assets/js/52.94318f32.js"><link rel="prefetch" href="/assets/js/53.8b8246af.js"><link rel="prefetch" href="/assets/js/54.1efb1958.js"><link rel="prefetch" href="/assets/js/55.6e720cbd.js"><link rel="prefetch" href="/assets/js/56.ff29ba34.js"><link rel="prefetch" href="/assets/js/57.a2a276ad.js"><link rel="prefetch" href="/assets/js/58.beb707bd.js"><link rel="prefetch" href="/assets/js/59.6523e7bd.js"><link rel="prefetch" href="/assets/js/6.d3e019f6.js"><link rel="prefetch" href="/assets/js/60.9243a169.js"><link rel="prefetch" href="/assets/js/61.fdff9ea9.js"><link rel="prefetch" href="/assets/js/62.a26471d2.js"><link rel="prefetch" href="/assets/js/63.b44b85e5.js"><link rel="prefetch" href="/assets/js/64.30e3fec8.js"><link rel="prefetch" href="/assets/js/65.15c314ec.js"><link rel="prefetch" href="/assets/js/66.0d055ca4.js"><link rel="prefetch" href="/assets/js/67.e48ac4e0.js"><link rel="prefetch" href="/assets/js/68.5b84fde1.js"><link rel="prefetch" href="/assets/js/69.18155c40.js"><link rel="prefetch" href="/assets/js/7.91ea37e8.js"><link rel="prefetch" href="/assets/js/70.3961293d.js"><link rel="prefetch" href="/assets/js/71.db54d8d7.js"><link rel="prefetch" href="/assets/js/72.5392e33a.js"><link rel="prefetch" href="/assets/js/73.6d1b4477.js"><link rel="prefetch" href="/assets/js/74.ff8e9236.js"><link rel="prefetch" href="/assets/js/75.c02626f4.js"><link rel="prefetch" href="/assets/js/76.2130b535.js"><link rel="prefetch" href="/assets/js/77.bd524f5d.js"><link rel="prefetch" href="/assets/js/78.7591201f.js"><link rel="prefetch" href="/assets/js/79.70f3e8d7.js"><link rel="prefetch" href="/assets/js/8.af3f7451.js"><link rel="prefetch" href="/assets/js/80.1a6fb22a.js"><link rel="prefetch" href="/assets/js/81.c5171f9b.js"><link rel="prefetch" href="/assets/js/82.39bc943c.js"><link rel="prefetch" href="/assets/js/83.6219db63.js"><link rel="prefetch" href="/assets/js/84.cf6cf3e8.js"><link rel="prefetch" href="/assets/js/85.b7d27581.js"><link rel="prefetch" href="/assets/js/86.610242fe.js"><link rel="prefetch" href="/assets/js/87.2ca59fbd.js"><link rel="prefetch" href="/assets/js/89.2bbe1854.js"><link rel="prefetch" href="/assets/js/9.1c63888c.js"><link rel="prefetch" href="/assets/js/90.6c980eb1.js"><link rel="prefetch" href="/assets/js/91.ca16c711.js"><link rel="prefetch" href="/assets/js/92.36fc0788.js"><link rel="prefetch" href="/assets/js/93.7182d914.js"><link rel="prefetch" href="/assets/js/94.9be4afb7.js"><link rel="prefetch" href="/assets/js/95.aafe5851.js"><link rel="prefetch" href="/assets/js/96.cdbba7a2.js"><link rel="prefetch" href="/assets/js/97.f47e564a.js"><link rel="prefetch" href="/assets/js/98.0506f292.js"><link rel="prefetch" href="/assets/js/99.4f1feacc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c0f2585a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="《Flutter实战·第二版》" class="logo"> <span class="site-name can-hide">《Flutter实战·第二版》</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/flutterchina/flukit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Flukit组件库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/flutterchina" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Flutter中国
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/flutterchina/flutter_in_action_2nd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/flutterchina/flukit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Flukit组件库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/flutterchina" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Flutter中国
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/flutterchina/flutter_in_action_2nd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/preface.html" class="sidebar-link">第二版序</a></li><li><section class="sidebar-group depth-0"><a href="/chapter1/index" class="sidebar-heading clickable open"><span>第一章：起步</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter1/mobile_development_intro.html" class="sidebar-link">1.1 移动开发技术简介</a></li><li><a href="/chapter1/flutter_intro.html" class="sidebar-link">1.2 初识 Flutter</a></li><li><a href="/chapter1/install_flutter.html" class="sidebar-link">1.3 搭建Flutter开发环境</a></li><li><a href="/chapter1/dart.html" aria-current="page" class="active sidebar-link">1.4 Dart语言简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chapter1/dart.html#_1-4-1-变量声明" class="sidebar-link">1.4.1 变量声明</a></li><li class="sidebar-sub-header"><a href="/chapter1/dart.html#_1-4-2-函数" class="sidebar-link">1.4.2 函数</a></li><li class="sidebar-sub-header"><a href="/chapter1/dart.html#_1-4-3-mixin" class="sidebar-link">1.4.3 mixin</a></li><li class="sidebar-sub-header"><a href="/chapter1/dart.html#_1-4-4-异步支持" class="sidebar-link">1.4.4 异步支持</a></li><li class="sidebar-sub-header"><a href="/chapter1/dart.html#_1-4-5-stream" class="sidebar-link">1.4.5 Stream</a></li><li class="sidebar-sub-header"><a href="/chapter1/dart.html#_1-4-6-dart和java及javascript对比" class="sidebar-link">1.4.6 Dart和Java及JavaScript对比</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter2/index" class="sidebar-heading clickable"><span>第二章：第一个Flutter应用</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter2/first_flutter_app.html" class="sidebar-link">2.1 计数器应用示例</a></li><li><a href="/chapter2/flutter_widget_intro.html" class="sidebar-link">2.2  Widget 简介</a></li><li><a href="/chapter2/state_manage.html" class="sidebar-link">2.3 状态管理</a></li><li><a href="/chapter2/flutter_router.html" class="sidebar-link">2.4 路由管理</a></li><li><a href="/chapter2/flutter_package_mgr.html" class="sidebar-link">2.5 包管理</a></li><li><a href="/chapter2/flutter_assets_mgr.html" class="sidebar-link">2.6 资源管理</a></li><li><a href="/chapter2/flutter_app_debug.html" class="sidebar-link">2.7 调试Flutter应用</a></li><li><a href="/chapter2/thread_model_and_error_report.html" class="sidebar-link">2.8 Flutter异常捕获</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter3/index" class="sidebar-heading clickable"><span>第三章：基础组件</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter3/text.html" class="sidebar-link">3.1 文本及样式</a></li><li><a href="/chapter3/buttons.html" class="sidebar-link">3.2 按钮</a></li><li><a href="/chapter3/img_and_icon.html" class="sidebar-link">3.3 图片及ICON</a></li><li><a href="/chapter3/radio_and_checkbox.html" class="sidebar-link">3.4 单选开关和复选框</a></li><li><a href="/chapter3/input_and_form.html" class="sidebar-link">3.5 输入框及表单</a></li><li><a href="/chapter3/progress.html" class="sidebar-link">3.6 进度指示器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter1/chapter4/index.md" class="sidebar-heading clickable"><span>第四章：布局类组件</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter4/intro.html" class="sidebar-link">4.1 布局类组件简介</a></li><li><a href="/chapter4/constraints.html" class="sidebar-link">4.2 布局原理与约束（constraints）</a></li><li><a href="/chapter4/row_and_column.html" class="sidebar-link">4.3 线性布局（Row和Column）</a></li><li><a href="/chapter4/flex.html" class="sidebar-link">4.4 弹性布局（Flex）</a></li><li><a href="/chapter4/wrap_and_flow.html" class="sidebar-link">4.5 流式布局</a></li><li><a href="/chapter4/stack.html" class="sidebar-link">4.6 层叠布局 Stack、Positioned</a></li><li><a href="/chapter4/alignment.html" class="sidebar-link">4.7 对齐与相对定位（Align）</a></li><li><a href="/chapter4/layoutbuilder.html" class="sidebar-link">4.8 LayoutBuilder、AfterLayout</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter5/index" class="sidebar-heading clickable"><span>第五章：容器类组件</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter5/padding.html" class="sidebar-link">5.1 填充（Padding）</a></li><li><a href="/chapter5/decoratedbox.html" class="sidebar-link">5.2 装饰容器DecoratedBox</a></li><li><a href="/chapter5/transform.html" class="sidebar-link">5.3 变换（Transform）</a></li><li><a href="/chapter5/container.html" class="sidebar-link">5.4 Container</a></li><li><a href="/chapter5/clip.html" class="sidebar-link">5.5 剪裁（Clip）</a></li><li><a href="/chapter5/fittedbox.html" class="sidebar-link">5.6 空间适配 FittedBox</a></li><li><a href="/chapter5/material_scaffold.html" class="sidebar-link">5.7 Scaffold</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter6/index" class="sidebar-heading clickable"><span>第六章：可滚动组件</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter6/intro.html" class="sidebar-link">6.1 可滚动组件简介</a></li><li><a href="/chapter6/single_child_scrollview.html" class="sidebar-link">6.2 SingleChildScrollView</a></li><li><a href="/chapter6/listview.html" class="sidebar-link">6.3 ListView</a></li><li><a href="/chapter6/scroll_controller.html" class="sidebar-link">6.4 滚动监听及控制</a></li><li><a href="/chapter6/animatedlist.html" class="sidebar-link">6.5 AnimatedList</a></li><li><a href="/chapter6/gridview.html" class="sidebar-link">6.6 GridView</a></li><li><a href="/chapter6/pageview.html" class="sidebar-link">6.7 PageView与页面缓存</a></li><li><a href="/chapter6/keepalive.html" class="sidebar-link">6.8 可滚动组件子项缓存 KeepAlive</a></li><li><a href="/chapter6/tabview.html" class="sidebar-link">6.9 TabBarView</a></li><li><a href="/chapter6/custom_scrollview.html" class="sidebar-link">6.10 CustomScrollView 和 Slivers</a></li><li><a href="/chapter6/sliver.html" class="sidebar-link">6.11 自定义 Sliver</a></li><li><a href="/chapter6/nestedscrollview.html" class="sidebar-link">6.12 嵌套可滚动组件 NestedScrollView</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter7/index" class="sidebar-heading clickable"><span>第七章：功能型组件</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter7/willpopscope.html" class="sidebar-link">7.1 导航返回拦截（WillPopScope）</a></li><li><a href="/chapter7/inherited_widget.html" class="sidebar-link">7.2 数据共享（InheritedWidget）</a></li><li><a href="/chapter7/provider.html" class="sidebar-link">7.3 跨组件状态共享（Provider）</a></li><li><a href="/chapter7/theme.html" class="sidebar-link">7.4 颜色和主题</a></li><li><a href="/chapter7/value_listenable_builder.html" class="sidebar-link">7.5 ValueListenableBuilder</a></li><li><a href="/chapter7/futurebuilder_and_streambuilder.html" class="sidebar-link">7.6 异步UI更新（FutureBuilder、StreamBuilder）</a></li><li><a href="/chapter7/dailog.html" class="sidebar-link">7.7 对话框详解</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter8/index" class="sidebar-heading clickable"><span>第八章：事件处理与通知</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter8/listener.html" class="sidebar-link">8.1 原始指针事件处理</a></li><li><a href="/chapter8/gesture.html" class="sidebar-link">8.2 手势识别</a></li><li><a href="/chapter8/hittest.html" class="sidebar-link">8.3 Flutter事件机制</a></li><li><a href="/chapter8/gesture_conflict.html" class="sidebar-link">8.4 手势原理与手势冲突</a></li><li><a href="/chapter8/eventbus.html" class="sidebar-link">8.5 事件总线</a></li><li><a href="/chapter8/notification.html" class="sidebar-link">8.6 通知 Notification</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter9/index" class="sidebar-heading clickable"><span>第九章：动画</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter9/intro.html" class="sidebar-link">9.1 Flutter动画简介</a></li><li><a href="/chapter9/animation_structure.html" class="sidebar-link">9.2 动画基本结构及状态监听</a></li><li><a href="/chapter9/route_transition.html" class="sidebar-link">9.3 自定义路由切换动画</a></li><li><a href="/chapter9/hero.html" class="sidebar-link">9.4 Hero动画</a></li><li><a href="/chapter9/stagger_animation.html" class="sidebar-link">9.5 交织动画</a></li><li><a href="/chapter9/animated_switcher.html" class="sidebar-link">9.6 动画切换组件（AnimatedSwitcher）</a></li><li><a href="/chapter9/animated_widgets.html" class="sidebar-link">9.7 动画过渡组件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter10/index" class="sidebar-heading clickable"><span>第十章：自定义组件</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter10/intro.html" class="sidebar-link">10.1 自定义组件方法简介</a></li><li><a href="/chapter10/combine.html" class="sidebar-link">10.2 组合现有组件</a></li><li><a href="/chapter10/turn_box.html" class="sidebar-link">10.3 组合实例：TurnBox</a></li><li><a href="/chapter10/custom_paint.html" class="sidebar-link">10.4 CustomPaint 与 Canvas</a></li><li><a href="/chapter10/gradient_circular_progress_demo.html" class="sidebar-link">10.5 自绘实例：圆形背景渐变进度条</a></li><li><a href="/chapter10/custom_checkbox.html" class="sidebar-link">10.6 自绘组件：CustomCheckbox</a></li><li><a href="/chapter10/done_widget.html" class="sidebar-link">10.7 自绘组件: DoneWidget</a></li><li><a href="/chapter10/watermark.html" class="sidebar-link">10.8 水印实例: 文本绘制与离屏渲染</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter11/index" class="sidebar-heading clickable"><span>第十一章：文件操作与网络请求</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter11/file_operation.html" class="sidebar-link">11.1 文件操作</a></li><li><a href="/chapter11/http.html" class="sidebar-link">11.2 通过HttpClient发起HTTP请求</a></li><li><a href="/chapter11/dio.html" class="sidebar-link">11.3 Http请求库-dio</a></li><li><a href="/chapter11/download_with_chunks.html" class="sidebar-link">11.4 实例：Http分块下载</a></li><li><a href="/chapter11/websocket.html" class="sidebar-link">11.5 使用WebSockets</a></li><li><a href="/chapter11/socket.html" class="sidebar-link">11.6 使用Socket API</a></li><li><a href="/chapter11/json_model.html" class="sidebar-link">11.7 Json转Dart Model类</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter12/index" class="sidebar-heading clickable"><span>第十二章：Flutter 扩展</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter12/package_and_plugin.html" class="sidebar-link">12.1 包和插件</a></li><li><a href="/chapter12/flutter_web.html" class="sidebar-link">12.2 Flutter Web</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter13/index" class="sidebar-heading clickable"><span>第十三章：国际化</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter13/multi_languages_support.html" class="sidebar-link">13.1 让App支持多语言</a></li><li><a href="/chapter13/locallization_implement.html" class="sidebar-link">13.2 实现Localizations</a></li><li><a href="/chapter13/intl.html" class="sidebar-link">13.3 使用Intl包</a></li><li><a href="/chapter13/faq.html" class="sidebar-link">13.4 国际化常见问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter14/index" class="sidebar-heading clickable"><span>第十四章：Flutter核心原理</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter14/flutter_ui_system.html" class="sidebar-link">14.1 Flutter UI 框架（Framework）</a></li><li><a href="/chapter14/element_buildcontext.html" class="sidebar-link">14.2 Element、BuildContext和RenderObject</a></li><li><a href="/chapter14/flutter_app_startup.html" class="sidebar-link">14.3 Flutter启动流程和渲染管线</a></li><li><a href="/chapter14/layout.html" class="sidebar-link">14.4 布局（Layout）过程</a></li><li><a href="/chapter14/paint.html" class="sidebar-link">14.5 绘制（一）绘制原理及Layer</a></li><li><a href="/chapter14/paint_flow.html" class="sidebar-link">14.6 绘制（二）组件树绘制流程</a></li><li><a href="/chapter14/layer.html" class="sidebar-link">14.7 绘制（三）Layer 实例</a></li><li><a href="/chapter14/compositing.html" class="sidebar-link">14.8 绘制（四）Compositing</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第十五章：一个完整的Flutter应用</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/chapter15/intro.html" class="sidebar-link">15.1 Github客户端示例</a></li><li><a href="/chapter15/code_structure.html" class="sidebar-link">15.2 Flutter APP代码结构</a></li><li><a href="/chapter15/models.html" class="sidebar-link">15.3 Model类定义</a></li><li><a href="/chapter15/globals.html" class="sidebar-link">15.4 全局变量及共享状态</a></li><li><a href="/chapter15/network.html" class="sidebar-link">15.5 网络请求封装</a></li><li><a href="/chapter15/entry.html" class="sidebar-link">15.6 APP入口及主页</a></li><li><a href="/chapter15/login_page.html" class="sidebar-link">15.7 登录页</a></li><li><a href="/chapter15/language_and_theme_setting.html" class="sidebar-link">15.8 多语言和多主题</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_1-4-dart语言简介"><a href="#_1-4-dart语言简介" class="header-anchor">#</a> 1.4 Dart语言简介</h1> <p>在之前我们已经介绍过 Dart 语言的相关特性，读者可以翻看一下，如果读者已经熟悉 Dart 语法，可以跳过本节，如果你还不了解 Dart，也不用担心，按照笔者经验，如果你有过其他编程语言经验（尤其是 Java 或 JavaScript）的话会非常容易上手 Dart。当然，如果你是 iOS 开发者，也不用担心，Dart 中也有一些与 Swift 比较相似的特性，如命名参数等，笔者当时学习 Dart 时，也只是花了一个小时，看完 Dart 官网的 Language Tour，就开始动手写 Flutter 了，所以不用怕。</p> <p>在笔者看来，Dart 在设计时应该是同时借鉴了 Java 和 JavaScript，同时又引入了一些现代编程语言的特性，如空安全，除此之外还有一些独创的语法，比如级联操作符。总之，熟悉之后，你会发现 Dart 是一门非常有意思的编程语言 ！</p> <p>Dart 在静态语法方面和 Java 非常相似，如类型定义、函数声明、泛型等，而在动态特性方面又和 JavaScript 很像，如函数式特性、异步支持等。除了融合 Java 和 JavaScript 语言之所长之外，Dart 也具有一些其它具有表现力的语法，如可选命名参数、<code>..</code>（级联运算符）和<code>?.</code>（条件成员访问运算符）以及<code>??</code>（判空赋值运算符）。其实，对编程语言了解比较多的读者会发现，在 Dart 中其实看到的不仅有 Java 和 JavaScript 的影子，它还具有其它编程语言中的身影，如命名参数在 Objective-C 和 Swift 中早就很普遍，而<code>??</code>操作符在PHP 7.0 语法中就已经存在了，因此我们可以看到 Google 对 Dart 语言给予厚望，是想把 Dart 打造成一门集百家之所长的编程语言。</p> <p>接下来，我们先对 Dart 语法做一个简单的介绍，然后再将 Dart 与 JavaScript 和 Java 做一个简要的对比，方便读者更好的理解。</p> <blockquote><p>注意：由于本书并非专门介绍 Dart 语言的书籍，所以本章主要会介绍一下在 Flutter 开发中常用的语法特性，如果想更多了解 Dart，读者可以去 Dart 官网学习，现在互联网上 Dart 相关资料已经很多了。另外 Dart 2. 14 已经正式发布，所以本书所有示例均采用 Dart  2.14 语法。</p></blockquote> <h2 id="_1-4-1-变量声明"><a href="#_1-4-1-变量声明" class="header-anchor">#</a> 1.4.1 变量声明</h2> <ol><li><p><strong>var</strong></p> <p>类似于 JavaScript 中的<code>var</code>，它可以接收任何类型的变量，但最大的不同是 Dart 中 var 变量一旦赋值，类型便会确定，则不能再改变其类型，如：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token string">&quot;hi world&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 下面代码在dart中会报错，因为变量t的类型已经确定为String，</span>
<span class="token comment">// 类型一旦确定后则不能再更改其类型。</span>
t <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>上面的代码在 JavaScript 是没有问题的，前端开发者需要注意一下，之所以有此差异是因为 Dart 本身是一个强类型语言，任何变量都是有确定类型的，在 Dart 中，当用<code>var</code>声明一个变量后，Dart 在编译时会根据第一次赋值数据的类型来推断其类型，编译结束后其类型就已经被确定，而 JavaScript 是纯粹的弱类型脚本语言，var 只是变量的声明方式而已。</p></li> <li><p><strong>dynamic</strong> 和 <strong>Object</strong></p> <p><code>Object</code> 是 Dart 所有对象的根基类，也就是说在 Dart 中所有类型都是<code>Object</code>的子类(包括Function和Null)，所以任何类型的数据都可以赋值给<code>Object</code>声明的对象。
<code>dynamic</code>与<code>Object</code>声明的变量都可以赋值任意对象，且后期可以改变赋值的类型，这和 <code>var</code> 是不同的，如：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">dynamic</span> t<span class="token punctuation">;</span>
<span class="token class-name">Object</span> x<span class="token punctuation">;</span>
t <span class="token operator">=</span> <span class="token string">&quot;hi world&quot;</span><span class="token punctuation">;</span>
x <span class="token operator">=</span> <span class="token string">'Hello Object'</span><span class="token punctuation">;</span>
<span class="token comment">//下面代码没有问题</span>
t <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
x <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>dynamic</code>与<code>Object</code>不同的是<code>dynamic</code>声明的对象编译器会提供所有可能的组合，而<code>Object</code>声明的对象只能使用 <code>Object</code> 的属性与方法, 否则编译器会报错，如:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code> <span class="token keyword">dynamic</span> a<span class="token punctuation">;</span>
 <span class="token class-name">Object</span> b <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
 <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   a <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
   <span class="token function">printLengths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>   

 <span class="token function">printLengths</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 正常</span>
<span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 报错 The getter 'length' is not defined for the class 'Object'</span>
   <span class="token function">print</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><code>dynamic</code>  的这个特点使得我们在使用它时需要格外注意，这很容易引入一个运行时错误，比如下面代码在编译时不会报错，而在运行时会报错：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token function">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>xx<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a是字符串，没有&quot;xx&quot;属性，编译时不会报错，运行时会报错</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><strong>final</strong>和<strong>const</strong></p> <p>如果您从未打算更改一个变量，那么使用 <code>final</code> 或 <code>const</code>，不是<code>var</code>，也不是一个类型。 一个 <code>final</code> 变量只能被设置一次，两者区别在于：<code>const</code> 变量是一个编译时常量（编译时直接替换为常量值），<code>final</code>变量在第一次使用时被初始化。被<code>final</code>或者<code>const</code>修饰的变量，变量类型可以省略，如：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token comment">//可以省略String这个类型声明</span>
<span class="token keyword">final</span> str <span class="token operator">=</span> <span class="token string">&quot;hi world&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//final String str = &quot;hi world&quot;; </span>
<span class="token keyword">const</span> str1 <span class="token operator">=</span> <span class="token string">&quot;hi world&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//const String str1 = &quot;hi world&quot;;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>空安全（null-safety）</p> <p>Dart 中一切都是对象，这意味着如果我们定义一个数字，在初始化它之前如果我们使用了它，假如没有某种检查机制，则不会报错，比如：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  int i<span class="token punctuation">;</span> 
  <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在 Dart 引入空安全之前，上面代码在执行前不会报错，但会触发一个运行时错误，原因是 i 的值为 null 。但现在有了空安全，则定义变量时我们可以指定变量是可空还是不可空。</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code>int i <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment">//默认为不可空，必须在定义时初始化。</span>
int<span class="token operator">?</span> j<span class="token punctuation">;</span> <span class="token comment">// 定义为可空类型，对于可空变量，我们在使用前必须判空。</span>

<span class="token comment">// 如果我们预期变量不能为空，但在定义时不能确定其初始值，则可以加上late关键字，</span>
<span class="token comment">// 表示会稍后初始化，但是在正式使用它之前必须得保证初始化过了，否则会报错</span>
late int k<span class="token punctuation">;</span>
k<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>如果一个变量我们定义为可空类型，在某些情况下即使我们给它赋值过了，但是预处理器仍然有可能识别不出，这时我们就要显式（通过在变量后面加一个”!“符号）告诉预处理器它已经不是null了，比如：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">{</span>
  int<span class="token operator">?</span> i<span class="token punctuation">;</span>
  <span class="token class-name">Function</span><span class="token operator">?</span> fun<span class="token punctuation">;</span>
  <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token operator">!</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//因为已经判过空，所以能走到这 i 必不为null，如果没有显式申明，则 IDE 会报错</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fun<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      fun<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 同上</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>上面中如果函数变量可空时，调用的时候可以用语法糖：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code>fun<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// fun 不为空时则会被调用</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <h2 id="_1-4-2-函数"><a href="#_1-4-2-函数" class="header-anchor">#</a> 1.4.2 函数</h2> <p>Dart是一种真正的面向对象的语言，所以即使是函数也是对象，并且有一个类型<strong>Function</strong>。这意味着函数可以赋值给变量或作为参数传递给其他函数，这是函数式编程的典型特征。</p> <ol><li><p>函数声明</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code>bool <span class="token function">isNoble</span><span class="token punctuation">(</span>int atomicNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> _nobleGases<span class="token punctuation">[</span>atomicNumber<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Dart函数声明如果没有显式声明返回值类型时会默认当做<code>dynamic</code>处理，注意，函数返回值没有类型推断：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">typedef</span> bool <span class="token function">CALLBACK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//不指定返回类型，此时默认为dynamic，不是bool</span>
<span class="token function">isNoble</span><span class="token punctuation">(</span>int atomicNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> _nobleGases<span class="token punctuation">[</span>atomicNumber<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">CALLBACK</span> cb<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
<span class="token comment">//报错，isNoble不是bool类型</span>
<span class="token function">test</span><span class="token punctuation">(</span>isNoble<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p>对于只包含一个表达式的函数，可以使用简写语法：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code>bool isNoble <span class="token punctuation">(</span>int atomicNumber<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span> <span class="token punctuation">;</span>   
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>函数作为变量：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">var</span> say <span class="token operator">=</span> <span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">print</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">say</span><span class="token punctuation">(</span><span class="token string">&quot;hi world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>函数作为参数传递：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">var</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>可选的位置参数</p> <p>包装一组函数参数，用[]标记为可选的位置参数，并放在参数列表的最后面：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token class-name">String</span> <span class="token function">say</span><span class="token punctuation">(</span><span class="token class-name">String</span> from<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token class-name">String</span> device<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token string">'$from says $msg'</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>device <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result <span class="token operator">=</span> <span class="token string">'$result with a $device'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>下面是一个不带可选参数调用这个函数的例子：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">'Bob'</span><span class="token punctuation">,</span> <span class="token string">'Howdy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//结果是： Bob says Howdy</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>下面是用第三个参数调用这个函数的例子：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">'Bob'</span><span class="token punctuation">,</span> <span class="token string">'Howdy'</span><span class="token punctuation">,</span> <span class="token string">'smoke signal'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//结果是：Bob says Howdy with a smoke signal</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>可选的命名参数</p> <p>定义函数时，使用{param1, param2, …}，放在参数列表的最后面，用于指定命名参数。例如：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token comment">//设置[bold]和[hidden]标志</span>
<span class="token keyword">void</span> <span class="token function">enableFlags</span><span class="token punctuation">(</span><span class="token punctuation">{</span>bool bold<span class="token punctuation">,</span> bool hidden<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ... </span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>调用函数时，可以使用指定命名参数。例如：<code>paramName: value</code></p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token function">enableFlags</span><span class="token punctuation">(</span>bold<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> hidden<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可选命名参数在Flutter中使用非常多。<strong>注意，不能同时使用可选的位置参数和可选的命名参数</strong>。</p></li></ol> <h2 id="_1-4-3-mixin"><a href="#_1-4-3-mixin" class="header-anchor">#</a> 1.4.3 mixin</h2> <p>Dart 是不支持多继承的，但是它支持 mixin，简单来讲 mixin 可以 “组合” 多个类，我们通过一个例子来理解。</p> <p>定义一个 Person 类，实现吃饭、说话、走路和写代码功能，同时定义一个 Dog 类，实现吃饭、和走路功能：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'say'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">mixin</span> <span class="token class-name">Eat</span> <span class="token punctuation">{</span>
  <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'eat'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">mixin</span> <span class="token class-name">Walk</span> <span class="token punctuation">{</span>
  <span class="token function">walk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'walk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">mixin</span> <span class="token class-name">Code</span> <span class="token punctuation">{</span>
  <span class="token function">code</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token keyword">with</span> <span class="token class-name">Eat</span><span class="token punctuation">,</span> <span class="token class-name">Walk</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Man</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token keyword">with</span> <span class="token class-name">Eat</span><span class="token punctuation">,</span> <span class="token class-name">Walk</span><span class="token punctuation">,</span> <span class="token class-name">Code</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>我们定义了几个 mixin，然后通过 with 关键字将它们组合成不同的类。有一点需要注意：如果多个mixin 中有同名方法，with 时，会默认使用最后面的 mixin 的，mixin 方法中可以通过 super 关键字调用之前 mixin 或类中的方法。我们这里只介绍 mixin 最基本的特性，关于 mixin 更详细的内容读者可以自行百度。</p> <h2 id="_1-4-4-异步支持"><a href="#_1-4-4-异步支持" class="header-anchor">#</a> 1.4.4 异步支持</h2> <p>Dart类库有非常多的返回<code>Future</code>或者<code>Stream</code>对象的函数。 这些函数被称为<strong>异步函数</strong>：它们只会在设置好一些耗时操作之后返回，比如像 IO操作。而不是等到这个操作完成。</p> <p><code>async</code>和<code>await</code>关键词支持了异步编程，允许您写出和同步代码很像的异步代码。</p> <h3 id="future"><a href="#future" class="header-anchor">#</a> Future</h3> <p><code>Future</code>与JavaScript中的<code>Promise</code>非常相似，表示一个异步操作的最终完成（或失败）及其结果值的表示。简单来说，它就是用于处理异步操作的，异步处理成功了就执行成功的操作，异步处理失败了就捕获错误或者停止后续操作。一个Future只会对应一个结果，要么成功，要么失败。</p> <p>由于本身功能较多，这里我们只介绍其常用的API及特性。还有，请记住，<code>Future</code> 的所有API的返回值仍然是一个<code>Future</code>对象，所以可以很方便的进行链式调用。</p> <h4 id="future-then"><a href="#future-then" class="header-anchor">#</a> Future.then</h4> <p>为了方便示例，在本例中我们使用<code>Future.delayed</code> 创建了一个延时任务（实际场景会是一个真正的耗时任务，比如一次网络请求），即2秒后返回结果字符串&quot;hi world!&quot;，然后我们在<code>then</code>中接收异步结果并打印结果，代码如下：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token class-name">Future</span><span class="token punctuation">.</span><span class="token function">delayed</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token string">&quot;hi world!&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token function">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="future-catcherror"><a href="#future-catcherror" class="header-anchor">#</a> Future.catchError</h4> <p>如果异步任务发生错误，我们可以在<code>catchError</code>中捕获错误，我们将上面示例改为：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token class-name">Future</span><span class="token punctuation">.</span><span class="token function">delayed</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">//return &quot;hi world!&quot;;</span>
   <span class="token keyword">throw</span> <span class="token class-name">AssertionError</span><span class="token punctuation">(</span><span class="token string">&quot;Error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">//执行成功会走到这里  </span>
   <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catchError</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">//执行失败会走到这里  </span>
   <span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在本示例中，我们在异步任务中抛出了一个异常，<code>then</code>的回调函数将不会被执行，取而代之的是 <code>catchError</code>回调函数将被调用；但是，并不是只有 <code>catchError</code>回调才能捕获错误，<code>then</code>方法还有一个可选参数<code>onError</code>，我们也可以用它来捕获异常：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token class-name">Future</span><span class="token punctuation">.</span><span class="token function">delayed</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//return &quot;hi world!&quot;;</span>
	<span class="token keyword">throw</span> <span class="token class-name">AssertionError</span><span class="token punctuation">(</span><span class="token string">&quot;Error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> onError<span class="token punctuation">:</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="future-whencomplete"><a href="#future-whencomplete" class="header-anchor">#</a> Future.whenComplete</h4> <p>有些时候，我们会遇到无论异步任务执行成功或失败都需要做一些事的场景，比如在网络请求前弹出加载对话框，在请求结束后关闭对话框。这种场景，有两种方法，第一种是分别在<code>then</code>或<code>catch</code>中关闭一下对话框，第二种就是使用<code>Future</code>的<code>whenComplete</code>回调，我们将上面示例改一下：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token class-name">Future</span><span class="token punctuation">.</span><span class="token function">delayed</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">//return &quot;hi world!&quot;;</span>
   <span class="token keyword">throw</span> <span class="token class-name">AssertionError</span><span class="token punctuation">(</span><span class="token string">&quot;Error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">//执行成功会走到这里 </span>
   <span class="token function">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catchError</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">//执行失败会走到这里   </span>
   <span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">whenComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">//无论成功或失败都会走到这里</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="future-wait"><a href="#future-wait" class="header-anchor">#</a> Future.wait</h4> <p>有些时候，我们需要等待多个异步任务都执行结束后才进行一些操作，比如我们有一个界面，需要先分别从两个网络接口获取数据，获取成功后，我们需要将两个接口数据进行特定的处理后再显示到UI界面上，应该怎么做？答案是<code>Future.wait</code>，它接受一个<code>Future</code>数组参数，只有数组中所有<code>Future</code>都执行成功后，才会触发<code>then</code>的成功回调，只要有一个<code>Future</code>执行失败，就会触发错误回调。下面，我们通过模拟<code>Future.delayed</code> 来模拟两个数据获取的异步任务，等两个异步任务都执行成功时，将两个异步任务的结果拼接打印出来，代码如下：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token class-name">Future</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token comment">// 2秒后返回结果  </span>
  <span class="token class-name">Future</span><span class="token punctuation">.</span><span class="token function">delayed</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 4秒后返回结果  </span>
  <span class="token class-name">Future</span><span class="token punctuation">.</span><span class="token function">delayed</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot; world&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">print</span><span class="token punctuation">(</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>results<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catchError</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>执行上面代码，4秒后你会在控制台中看到“hello world”。</p> <h3 id="async-await"><a href="#async-await" class="header-anchor">#</a> Async/await</h3> <p>Dart中的<code>async/await</code> 和JavaScript中的<code>async/await</code>功能和用法是一模一样的，如果你已经了解JavaScript中的<code>async/await</code>的用法，可以直接跳过本节。</p> <h4 id="回调地狱-callback-hell"><a href="#回调地狱-callback-hell" class="header-anchor">#</a> 回调地狱(Callback Hell)</h4> <p>如果代码中有大量异步逻辑，并且出现大量异步任务依赖其它异步任务的结果时，必然会出现<code>Future.then</code>回调中套回调情况。举个例子，比如现在有个需求场景是用户先登录，登录成功后会获得用户ID，然后通过用户ID，再去请求用户个人信息，获取到用户个人信息后，为了使用方便，我们需要将其缓存在本地文件系统，代码如下：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token comment">//先分别定义各个异步任务</span>
<span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token class-name">String</span> pwd<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token comment">//用户登录</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token comment">//获取用户信息 </span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Future</span> <span class="token function">saveUserInfo</span><span class="token punctuation">(</span><span class="token class-name">String</span> userInfo<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token comment">// 保存用户信息 </span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>接下来，执行整个任务流：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token function">login</span><span class="token punctuation">(</span><span class="token string">&quot;alice&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;******&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token comment">//登录成功后通过，id获取用户信息    </span>
 <span class="token function">getUserInfo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//获取用户信息后保存 </span>
    <span class="token function">saveUserInfo</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token comment">//保存用户信息，接下来执行其它操作</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>可以感受一下，如果业务逻辑中有大量异步依赖的情况，将会出现上面这种在回调里面套回调的情况，过多的嵌套会导致的代码可读性下降以及出错率提高，并且非常难维护，这个问题被形象的称为<strong>回调地狱（Callback Hell）</strong>。回调地狱问题在之前 JavaScript 中非常突出，也是 JavaScript 被吐槽最多的点，但随着 ECMAScript 标准发布后，这个问题得到了非常好的解决，而解决回调地狱的两大神器正是 ECMAScript6 引入了<code>Promise</code>，以及ECMAScript7 中引入的<code>async/await</code>。 而在 Dart 中几乎是完全平移了 JavaScript 中的这两者：<code>Future</code>相当于<code>Promise</code>，而<code>async/await</code>连名字都没改。接下来我们看看通过<code>Future</code>和<code>async/await</code>如何消除上面示例中的嵌套问题。</p> <h5 id="使用future消除callback-hell"><a href="#使用future消除callback-hell" class="header-anchor">#</a> 使用Future消除Callback Hell</h5> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token function">login</span><span class="token punctuation">(</span><span class="token string">&quot;alice&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;******&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">{</span>
  	<span class="token keyword">return</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">saveUserInfo</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">//执行接下来的操作 </span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catchError</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//错误处理  </span>
  <span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>正如上文所述， <em>“<code>Future</code> 的所有API的返回值仍然是一个<code>Future</code>对象，所以可以很方便的进行链式调用”</em> ，如果在then 中返回的是一个<code>Future</code>的话，该<code>future</code>会执行，执行结束后会触发后面的<code>then</code>回调，这样依次向下，就避免了层层嵌套。</p> <h5 id="使用-async-await-消除-callback-hell"><a href="#使用-async-await-消除-callback-hell" class="header-anchor">#</a> 使用 async/await 消除 callback hell</h5> <p>通过<code>Future</code>回调中再返回<code>Future</code>的方式虽然能避免层层嵌套，但是还是有一层回调，有没有一种方式能够让我们可以像写同步代码那样来执行异步任务而不使用回调的方式？答案是肯定的，这就要使用<code>async/await</code>了，下面我们先直接看代码，然后再解释，代码如下：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
   <span class="token keyword">try</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> id <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token string">&quot;alice&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;******&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> userInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">saveUserInfo</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//执行接下来的操作   </span>
   <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//错误处理   </span>
    <span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>   
   <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li><code>async</code>用来表示函数是异步的，定义的函数会返回一个<code>Future</code>对象，可以使用 then 方法添加回调函数。</li> <li><code>await</code> 后面是一个<code>Future</code>，表示等待该异步任务完成，异步完成后才会往下走；<code>await</code>必须出现在 <code>async</code> 函数内部。</li></ul> <p>可以看到，我们通过<code>async/await</code>将一个异步流用同步的代码表示出来了。</p> <blockquote><p>其实，无论是在 JavaScript 还是 Dart 中，<code>async/await</code> 都只是一个语法糖，编译器或解释器最终都会将其转化为一个 Promise（Future）的调用链。</p></blockquote> <h2 id="_1-4-5-stream"><a href="#_1-4-5-stream" class="header-anchor">#</a> 1.4.5 Stream</h2> <p><code>Stream</code> 也是用于接收异步事件数据，和 <code>Future</code> 不同的是，它可以接收多个异步操作的结果（成功或失败）。 也就是说，在执行异步任务时，可以通过多次触发成功或失败事件来传递结果数据或错误异常。 <code>Stream</code> 常用于会多次读取数据的异步任务场景，如网络内容下载、文件读写等。举个例子：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">fromFutures</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token comment">// 1秒后返回结果</span>
  <span class="token class-name">Future</span><span class="token punctuation">.</span><span class="token function">delayed</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello 1&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 抛出一个异常</span>
  <span class="token class-name">Future</span><span class="token punctuation">.</span><span class="token function">delayed</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token class-name">AssertionError</span><span class="token punctuation">(</span><span class="token string">&quot;Error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 3秒后返回结果</span>
  <span class="token class-name">Future</span><span class="token punctuation">.</span><span class="token function">delayed</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello 3&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token function">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> onError<span class="token punctuation">:</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>onDone<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>上面的代码依次会输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>I/flutter (17666): hello 1
I/flutter (17666): Error
I/flutter (17666): hello 3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>代码很简单，就不赘述了。</p> <blockquote><p>思考题：既然 Stream 可以接收多次事件，那能不能用 Stream 来实现一个订阅者模式的事件总线？</p></blockquote> <h2 id="_1-4-6-dart和java及javascript对比"><a href="#_1-4-6-dart和java及javascript对比" class="header-anchor">#</a> 1.4.6 Dart和Java及JavaScript对比</h2> <p>通过上面介绍，相信你对 Dart 应该有了一个初步的印象，由于笔者平时也使用 Java 和 JavaScript，下面笔者根据自己的经验，结合 Java 和 JavaScript，谈一下自己的看法。</p> <blockquote><p>之所以将 Dart 与 Java 和 JavaScript 对比，是因为，这两者分别是强类型语言和弱类型语言的典型代表，并且 Dart 语法中很多地方也都借鉴了 Java 和 JavaScript。</p></blockquote> <h3 id="dart-vs-java"><a href="#dart-vs-java" class="header-anchor">#</a> Dart vs Java</h3> <p>客观的来讲，Dart 在语法层面确实比 Java 更有表现力；在 VM 层面，Dart VM 在内存回收和吞吐量都进行了反复的优化，但具体的性能对比，笔者没有找到相关测试数据，但在笔者看来，只要 Dart 语言能流行，VM 的性能就不用担心，毕竟 Google 在 Go（没用VM但有GC）、JavaScript（v8）、Dalvik（ Android 上的 Java VM ）上已经有了很多技术积淀。值得注意的是 Dart 在 Flutter 中已经可以将 GC 做到 10ms 以内，所以 Dart 和 Java 相比，决胜因素并不会是在性能方面。而在语法层面，Dart 要比 Java 更有表现力，最重要的是 Dart 对函数式编程支持要远强于 Java（目前只停留在 Lambda 表达式），而 Dart 目前真正的不足是<strong>生态</strong>，但笔者相信，随着 Flutter 的逐渐火热，会回过头来反推 Dart 生态加速发展，对于 Dart 来说，现在需要的是时间。</p> <h3 id="dart-vs-javascript"><a href="#dart-vs-javascript" class="header-anchor">#</a> Dart vs JavaScript</h3> <p>JavaScript 的弱类型一直被抓短，所以 TypeScript 甚至是 Facebook 的 Flow 才有市场。就笔者使用过的脚本语言中（笔者曾使用过 Python、PHP），JavaScript 无疑是<strong>动态化</strong>支持最好的脚本语言，比如在 JavaScript 中，可以给任何对象在任何时候动态扩展属性，对于精通 JavaScript 的高手来说，这无疑是一把利剑。但是，任何事物都有两面性，JavaScript 强大的动态化特性也是把双刃剑，你可经常听到另一个声音，认为 JavaScript 的这种动态性糟糕透了，太过灵活反而导致代码很难预期，无法限制不被期望的修改。毕竟有些人总是对自己或别人写的代码不放心，他们希望能够让代码变得可控，并期望有一套静态类型检查系统来帮助自己减少错误。正因如此，在 Flutter中，Dart 几乎放弃了脚本语言动态化的特性，如不支持反射、也不支持动态创建函数等。并且 Dart 从 2.0 开始强制开启了类型检查（Strong Mode），原先的检查模式（checked mode）和可选类型（optional type）将淡出，所以在类型安全这个层面来说，Dart 和 TypeScript、CoffeeScript 是差不多的，所以单从动态性来看，Dart 并不具备什么明显优势，但综合起来看，Dart 既能进行服务端脚本、APP 开发、Web 开发，这就有优势了！</p> <p>笔者在本书第一版的时候就表示过很看好 Dart 语言的将来，事实上，这几年，在 Github 上 Dart 语言开发的项目数量一直保持高速增长，所以 enjoy it !</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/chapter1/install_flutter.html" class="prev">
        1.3 搭建Flutter开发环境
      </a></span> <span class="next"><a href="/chapter2/first_flutter_app.html">
        2.1 计数器应用示例
      </a>
      →
    </span></p></div> <div style="text-align:center;"><img src="/assets/img/pay.a6c3cb25.jpeg" width="200"> <div> 请作者喝杯咖啡 </div></div> <div class="copyright"> 版权所有，禁止私自转发、克隆网站。</div> <div class="f-links" style="text-align:center;"><a href="https://github.com/flutterchina">
          Flutter中国开源项目
        </a> |
        <a href="/join_us.html">
          和作者做同事
        </a></div></main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2b1dcc57.js" defer></script><script src="/assets/js/28.44b1edff.js" defer></script><script src="/assets/js/2.c4880edd.js" defer></script><script src="/assets/js/88.dd1d66b6.js" defer></script>
  </body>
</html>
